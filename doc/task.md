# 居民用电分析系统 - 开发任务清单

> **版本**: 1.0
> **创建日期**: 2025年12月27日
> **说明**: 按照最合理的开发顺序组织的任务清单

---

## 📋 阶段0：项目初始化与环境搭建

### 0.1 开发环境配置
- [ ] 安装 Python 3.11+
- [ ] 配置 uv 包管理器
- [ ] 安装 CUDA 和 PyTorch（验证 RTX 3050 可用）
- [ ] 安装 Node.js 和 npm/pnpm（前端开发）
- [ ] 配置 Git 仓库和 .gitignore

### 0.2 项目结构初始化
- [ ] 创建后端项目结构（backend/）
- [ ] 创建前端项目结构（frontend/）
- [ ] 创建数据目录（data/raw, data/processed, data/models）
- [ ] 创建文档目录（docs/api, docs/models）
- [ ] 编写项目 README.md

### 0.3 依赖管理
- [ ] 后端 pyproject.toml 配置（Robyn, PyTorch, Pandas, etc.）
- [ ] 前端 package.json 配置（React, TypeScript, Vite, ECharts）
- [ ] 安装所有依赖并验证

---

## 📋 阶段1：数据处理基础设施

### 1.1 数据导入模块
- [ ] 实现 CSV 数据读取功能
- [ ] 实现 Excel 数据读取功能
- [ ] 数据格式验证（时间戳 + 用电量字段检查）
- [ ] 单元测试（使用 REFIT/UCI 样本数据）

### 1.2 数据预处理模块
- [ ] 缺失值检测和填充（线性插值/均值填充）
- [ ] 异常值检测和处理（3-sigma 原则）
- [ ] 时间序列对齐（统一时间粒度为小时）
- [ ] 数据标准化（MinMax/Z-score）
- [ ] 单元测试

### 1.3 数据存储
- [ ] 设计数据库 Schema（或选择 CSV 存储方案）
- [ ] 实现数据持久化接口
- [ ] 实现数据查询接口（按时间范围、用户ID等）

---

## 📋 阶段2：基础统计分析

### 2.1 统计指标计算
- [ ] 总用电量计算
- [ ] 日均用电量计算
- [ ] 最高/最低负荷识别（含时间戳）
- [ ] 峰谷平时段定义（可配置）
- [ ] 峰谷平用电比例统计
- [ ] 用电趋势计算（同比/环比）

### 2.2 负荷特征提取
- [ ] 24小时负荷曲线生成
- [ ] 周负荷曲线生成（7天）
- [ ] 月负荷曲线生成（30天）
- [ ] 特征向量提取（为聚类/分类准备）

### 2.3 简单行为分类
- [ ] 基于规则的分类实现（白天型/夜间型/均衡型）
- [ ] 或 K-Means 聚类实现（可选）
- [ ] 分类结果标签生成

---

## 📋 阶段3：可视化与报告

### 3.1 后端图表生成
- [ ] Matplotlib 负荷曲线图生成
- [ ] Pyecharts 峰谷比例饼图生成
- [ ] 趋势分析折线图生成
- [ ] 图表数据接口（返回 JSON 供前端 ECharts 使用）

### 3.2 报告导出
- [ ] PDF 报告生成（WeasyPrint 或 ReportLab）
- [ ] Excel 报告生成（Pandas to_excel）
- [ ] 报告模板设计（包含图表和统计数据）
- [ ] 下载接口实现

---

## 📋 阶段4：后端 API 开发（Robyn）

### 4.1 API 基础设施
- [ ] Robyn 应用初始化
- [ ] 路由结构设计
- [ ] CORS 配置（支持前端跨域）
- [ ] 错误处理中间件
- [ ] 日志系统配置

### 4.2 核心 API 接口
- [ ] POST /api/data/upload（数据上传）
- [ ] GET /api/data/list（数据列表）
- [ ] POST /api/analysis/statistics（统计分析）
- [ ] GET /api/analysis/charts（图表数据）
- [ ] GET /api/reports/export（报告导出）
- [ ] API 文档编写（Swagger/OpenAPI）

### 4.3 并发与性能
- [ ] 异步处理优化
- [ ] 请求限流（防止滥用）
- [ ] 响应缓存（Redis，可选）
- [ ] 性能测试（确保响应 ≤ 3秒）

---

## 📋 阶段5：前端开发（React）

### 5.1 前端基础设施
- [ ] Vite + React + TypeScript 项目初始化
- [ ] 路由配置（React Router）
- [ ] 状态管理（Context API 或 Zustand）
- [ ] UI 框架集成（Ant Design 或 shadcn/ui）
- [ ] ECharts 集成

### 5.2 核心页面开发
- [ ] 数据上传页面（文件选择 + 上传进度）
- [ ] 仪表盘页面（图表展示）
  - [ ] 负荷曲线图（24h/7d/30d 切换）
  - [ ] 峰谷比例饼图
  - [ ] 统计指标卡片
- [ ] 报告下载功能
- [ ] 响应式布局适配

### 5.3 交互优化
- [ ] Loading 状态处理
- [ ] 错误提示（Toast/Notification）
- [ ] 图表交互（缩放、数据点悬停）

---

## 📋 阶段6：深度学习模型开发

### 6.1 数据准备
- [ ] 下载公开数据集（UK-DALE, REFIT, UCI）
- [ ] 数据标注（行为模式标签自动生成）
- [ ] 训练/验证/测试集划分（7:2:1）
- [ ] 数据增强实现（时间平移、噪声注入）
- [ ] DataLoader 实现

### 6.2 LSTM 行为分类模型
- [ ] 模型架构定义（LSTM + Dropout + FC + Softmax）
- [ ] 损失函数选择（CrossEntropyLoss）
- [ ] 优化器配置（Adam + 学习率调度）
- [ ] 训练脚本编写
- [ ] 验证和测试（目标：准确率 ≥ 85%）
- [ ] 模型保存（.pth 文件）

### 6.3 Autoencoder 异常检测模型
- [ ] 编码器架构定义
- [ ] 解码器架构定义
- [ ] 重构损失函数（MSE）
- [ ] 训练脚本编写（仅使用正常数据）
- [ ] 异常阈值确定（基于验证集重构误差分布）
- [ ] 模型保存

### 6.4 模型集成
- [ ] 模型推理接口封装
- [ ] 模型加载和缓存机制
- [ ] 批量推理支持
- [ ] 推理性能优化（目标：≤ 2秒）
- [ ] 单元测试

### 6.5 API 接口
- [ ] POST /api/ml/classify（行为分类）
- [ ] POST /api/ml/detect_anomaly（异常检测）
- [ ] GET /api/ml/model_info（模型信息）

---

## 📋 阶段7：异常告警系统

### 7.1 告警规则引擎
- [ ] 异常检测触发条件定义
- [ ] 告警阈值配置（可调）
- [ ] 告警去重机制（避免频繁发送）
- [ ] 告警历史记录

### 7.2 邮件通知
- [ ] SMTP 配置（支持 Gmail, QQ 等）
- [ ] 邮件模板设计（HTML 格式）
- [ ] 异步邮件发送（不阻塞主线程）
- [ ] 发送失败重试机制

### 7.3 告警管理 API
- [ ] POST /api/alerts/config（配置告警规则）
- [ ] GET /api/alerts/history（告警历史）
- [ ] POST /api/alerts/test（测试邮件发送）

### 7.4 前端集成
- [ ] 告警配置页面（邮箱设置、阈值配置）
- [ ] 告警历史展示页面

---

## 📋 阶段8：LLM 智能问答 Agent

### 8.1 LLM 后端集成
- [ ] OpenAI API 接入
- [ ] Anthropic API 接入
- [ ] Ollama 本地部署配置（可选）
- [ ] 多后端切换逻辑
- [ ] API Key 管理

### 8.2 Agent 逻辑
- [ ] 上下文构建模块（用户画像 + 分析结果 + 历史数据）
- [ ] Prompt 模板设计
- [ ] 对话历史管理（支持多轮对话）
- [ ] 流式输出支持

### 8.3 Agent API
- [ ] POST /api/agent/chat（对话接口）
- [ ] GET /api/agent/history（对话历史）
- [ ] DELETE /api/agent/reset（重置会话）

### 8.4 前端集成
- [ ] 智能问答页面（聊天界面）
- [ ] 消息流式渲染
- [ ] Markdown 渲染（代码高亮等）

---

## 📋 阶段9：模拟数据生成器

### 9.1 数据生成逻辑
- [ ] 基于统计分布的数据生成（正态分布 + 时段权重）
- [ ] 多种行为模式模拟（早出晚归型、夜猫子型等）
- [ ] 异常数据注入（用于测试异常检测）

### 9.2 定时任务
- [ ] APScheduler 配置
- [ ] 定时生成任务（每小时/每天）
- [ ] 自动发送至后端 API（POST /api/data/upload）

### 9.3 控制接口
- [ ] POST /api/simulator/start（启动模拟器）
- [ ] POST /api/simulator/stop（停止模拟器）
- [ ] GET /api/simulator/status（模拟器状态）

---

## 📋 阶段10：系统集成与测试

### 10.1 集成测试
- [ ] 端到端测试（数据上传 → 分析 → 可视化 → 导出）
- [ ] 深度学习模型集成测试
- [ ] 告警系统集成测试
- [ ] Agent 集成测试

### 10.2 性能测试
- [ ] 并发测试（多用户同时访问）
- [ ] 响应时间测试（API ≤ 3秒）
- [ ] 推理速度测试（模型 ≤ 2秒）
- [ ] 内存占用监控

### 10.3 安全测试
- [ ] SQL 注入测试（如使用数据库）
- [ ] XSS 攻击测试
- [ ] CSRF 防护验证
- [ ] API 鉴权测试（如有）

---

## 📋 阶段11：优化与部署

### 11.1 代码优化
- [ ] 代码重构（消除重复代码）
- [ ] 性能瓶颈优化
- [ ] 错误处理完善
- [ ] 日志记录完善

### 11.2 文档编写
- [ ] API 文档完善
- [ ] 用户手册编写
- [ ] 部署指南编写
- [ ] 模型训练文档编写

### 11.3 部署准备
- [ ] Docker 容器化（可选）
- [ ] 生产环境配置文件
- [ ] 启动脚本编写
- [ ] 监控和日志配置

### 11.4 演示准备
- [ ] 演示数据准备
- [ ] 演示脚本编写
- [ ] PPT 制作
- [ ] 答辩准备

---

## 📋 阶段12：论文撰写

### 12.1 论文结构
- [ ] 摘要
- [ ] 引言（研究背景、意义、目标）
- [ ] 相关工作综述
- [ ] 系统需求分析
- [ ] 系统设计（架构、模块、接口）
- [ ] 实现细节（关键技术、算法）
- [ ] 实验与测试（性能评估、对比实验）
- [ ] 总结与展望

### 12.2 论文完善
- [ ] 图表制作（架构图、流程图、实验结果）
- [ ] 参考文献整理
- [ ] 格式调整（符合学校要求）
- [ ] 查重检查
- [ ] 导师审阅修改

---

## 🎯 关键里程碑检查点

- [ ] **里程碑1**: 基础系统可运行（数据上传 + 统计分析 + 简单可视化）
- [ ] **里程碑2**: 深度学习模型训练完成且准确率 ≥ 85%
- [ ] **里程碑3**: 完整 Web 应用可演示（前后端联调完成）
- [ ] **里程碑4**: 所有高级功能集成（告警 + Agent + 模拟器）
- [ ] **里程碑5**: 性能指标达标（响应 ≤ 3s, 推理 ≤ 2s, 并发支持）
- [ ] **里程碑6**: 论文初稿完成（≥ 15000字）
- [ ] **里程碑7**: 系统最终交付（代码 + 文档 + 演示）

---

## 📝 开发建议

1. **优先级原则**: 先完成核心功能（阶段1-5），再开发高级功能（阶段6-9）
2. **迭代开发**: 每个阶段完成后立即测试验证，确保可用后再进入下一阶段
3. **版本控制**: 每完成一个模块提交一次 Git，便于回溯
4. **文档同步**: 边开发边写文档，不要积压到最后
5. **性能监控**: 从一开始就关注性能指标，避免后期大规模重构
