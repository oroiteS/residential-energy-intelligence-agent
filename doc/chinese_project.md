# 项目需求规划文档 v5.0

> **文档版本**: 5.0
> **最后更新**: 2025年12月27日
> **文档性质**: 项目需求规范（供开发者、AI助手参考执行）

# 🎯 居民用电分析和节能建议智能体系统

---

## 📊 一、项目概述

### 1.1 项目定位

本项目是一个**面向居民的智能用电分析与节能建议系统**，旨在通过现代AI技术分析家庭用电行为，自动生成可视化报告并提供个性化节能建议。

**双重目标**：

- ✅ **满足毕业设计要求**：完整实现导师要求的所有核心功能
- ✅ **展示研究潜力**：采用现代深度学习技术，体现AI工程能力

### 1.2 核心价值

| 维度      | 价值体现                       |
| ------- | -------------------------- |
| **实用性** | 帮助居民理解用电行为，降低电费支出          |
| **技术性** | 从零训练神经网络，展示完整ML工程能力        |
| **创新性** | 结合深度学习与LLM Agent，提供智能化交互体验 |
| **完整性** | 端到端全栈系统，包含数据处理、模型训练、Web应用  |

### 1.3 核心性能指标（源自任务书）

| 指标 | 要求 |
|------|------|
| **模型精度** | 行为分类准确率 ≥ 85% |
| **系统响应** | API 接口响应时间 ≤ 3 秒 |
| **推理速度** | 单次模型推理时间 ≤ 2 秒 |
| **并发支持** | 支持多用户并发访问 |
| **运行环境** | 本地 RTX 3050 Laptop 稳定运行 |

---

## 🎯 二、功能需求（分层设计）

### 2.1 核心功能层（导师要求 - 必须完成）

#### ✅ 模块1：数据导入与预处理

- **功能**：支持CSV/Excel格式的用电数据导入（时间戳 + 用电量）
- **技术实现**：
  - 使用Pandas进行数据读取和清洗
  - 自动处理缺失值、异常值
  - 数据标准化和时间对齐
  - 支持小时粒度数据

#### ✅ 模块2：基础统计分析

- **功能**：
  - 总用电量、日均用电量计算
  - 最高/最低负荷识别
  - 峰谷平时段用电比例统计
  - 用电趋势分析
- **技术实现**：
  - NumPy/Pandas进行统计计算
  - 预设峰谷平时段规则（可配置）

#### ✅ 模块3：负荷模式识别（基础版）

- **功能**：判断用户用电类型
  - "白天用电型"
  - "夜间用电型"  
  - "均衡型"
- **技术实现**：
  - **方案A（快速实现）**：基于规则的分类（时段用电占比阈值）
  - **方案B（推荐）**：简单聚类算法（K-Means）+ 规则解释

#### ✅ 模块4：可视化报告生成与导出

- **功能**：
  - 用电负荷曲线图（24小时/7天/30天）
  - 峰谷用电比例饼图
  - 用电趋势折线图
  - 同比/环比对比图
  - **报告导出**（PDF/Excel格式）
- **技术实现**：
  - 后端：Matplotlib/Pyecharts生成图表
  - 前端：ECharts交互式图表展示
  - 导出：WeasyPrint/ReportLab 生成 PDF，Pandas 生成 Excel

#### ✅ 模块5：节能建议生成（基础版）

- **功能**：基于分析结果生成文字建议
- **技术实现**：
  - 预定义规则模板
  - 示例："您家峰时用电占比XX%，建议将洗衣、充电等安排在谷时进行"

#### ✅ 模块6：仪表盘展示界面

- **功能**：集中展示所有分析结果
- **技术实现**：
  - 使用 Robyn + React 构建完整Web应用（任务书要求前后端分离）

#### ✅ 模块7：异常用电告警

- **功能**：检测到用电异常时自动发送告警通知
  - 突发高负荷告警
  - 持续低负荷告警（可能外出/设备故障）
  - 用电模式突变告警
- **技术实现**：
  - 基于 Autoencoder 异常检测结果触发
  - 邮件通知：SMTP 发送告警邮件
  - 可配置告警阈值和通知频率

#### ✅ 模块8：模拟用电数据生成

- **功能**：模拟电表数据上传，用于系统测试和演示
  - 定时生成随机用电数据
  - 模拟不同用电行为模式
  - 自动发送数据到后端 API
- **技术实现**：
  - 后台定时任务（APScheduler / Celery）
  - 基于统计分布生成模拟数据（正态分布 + 时段权重）
  - HTTP POST 请求发送至数据导入接口

---

### 2.2 增强功能层（高级特性 - 体现技术深度）

#### 🚀 模块9：深度学习行为分析模型（核心亮点）

**任务定位**：用电行为模式分类 + 异常检测

##### 9.1 行为模式分类器（基于LSTM）

- **输入**：用电时序数据（24小时 × N天）

- **输出**：行为模式类别
  
  - 早出晚归型（上班族）
  - 居家办公型
  - 夜猫子型
  - 节能型
  - 高耗能型

- **模型架构选择**（推荐优先级）：

  - **LSTM**（长短期记忆网络，推荐⭐⭐⭐⭐⭐）

    - 优势：专为时序数据设计，能捕捉长期依赖关系

    - 结构：输入层 → LSTM层 → Dropout → 全连接层 → Softmax输出

    - 参数量：<1M，适合3050 Laptop训练和推理

##### 9.2 异常检测模块（基于Autoencoder）

- **输入**：实时用电数据

- **输出**：异常分数 + 异常类型
  
  - 突发高负荷
  - 持续低负荷（可能外出）
  - 模式突变

- **模型架构**：
  
  - **Autoencoder**（自编码器，推荐⭐⭐⭐⭐⭐）
    
    - 原理：通过重构误差检测异常
    
    - 结构：编码器（降维）→ 潜在空间 → 解码器（重构）
    
    - 优势：无监督学习，无需标注异常数据

##### 9.3 训练策略

- **数据集**：
  
  - 公开数据集：UK-DALE, REFIT, Pecan Street
  
  - 数据增强：时间平移、噪声注入、窗口滑动
  
  - 标签生成：基于作息时间规则自动标注

- **训练框架**：PyTorch 2.0+ with CUDA

- **训练环境**：RTX 3050 Laptop（本地训练，无需云GPU）

- **推理环境**：RTX 3050 Laptop（部署阶段）

- **优化技术**：
  
  - 梯度裁剪（防止梯度爆炸）
  
  - Dropout正则化（防止过拟合）
  
  - 学习率调度（动态调整学习率）
  
  - 早停法（Early Stopping）

#### 🤖 模块10：LLM智能问答Agent

**功能升级**：从规则模板 → 智能对话式建议

##### 10.1 Agent能力

- 解读深度学习模型的分析结果
- 生成个性化、上下文相关的节能建议
- 回答用户关于用电行为的问题
- 提供设备使用优化建议

##### 10.2 技术实现

- **LLM接入**（多后端支持）：
  
  - OpenAI API（GPT-4/GPT-3.5）
  - Anthropic API（Claude）
  - Ollama本地部署（Llama 3, Qwen等）

- **上下文构建**：
  
  ```
  系统提示词 + 用户画像 + 模型分析结果 + 历史数据统计 → LLM → 个性化建议
  ```

- **Agent框架**：LangChain或自定义Agent

##### 10.3 工作流程

```
用户上传数据
    ↓
基础统计分析（满足导师要求）
    ↓
深度学习模型分析（行为分类 + 异常检测）
    ↓
分析结果作为上下文
    ↓
LLM Agent生成建议
    ↓
可视化报告 + 智能问答界面
```

---

### 2.3 可选扩展层（时间允许时）

- 📱 移动端适配
- 📊 多用户对比分析
- 🏠 设备级负荷分解（NILM）
- 📈 短期负荷预测（辅助功能）

---

## 🛠️ 三、技术架构

### 3.1 技术栈选择

#### 后端技术栈

| 组件        | 技术选型                                  | 理由                        |
| --------- | ------------------------------------- | ------------------------- |
| **Web框架** | **Robyn**（高性能异步框架） | 任务书要求，前后端分离架构 |
| **深度学习**  | PyTorch 2.0+                          | 必须，支持CUDA                 |
| **数据处理**  | Pandas, NumPy                         | 导师要求                      |
| **可视化**   | Matplotlib, Pyecharts                 | 导师要求                      |
| **包管理**   | uv                                    | 现代化包管理                    |
| **LLM集成** | LangChain / 自定义                       | 多后端支持                     |

#### 前端技术栈

| 组件       | 技术选型                      | 理由      |
| -------- | ------------------------- | ------- |
| **框架** | React + TypeScript + Vite | 任务书要求，展示全栈能力  |
| **图表库**  | ECharts                   | 交互式可视化  |
| **UI框架** | Ant Design / shadcn/ui    | 现代化UI   |

#### 模型架构

| 任务       | 推荐架构          | 备选方案               |
| -------- | ------------- | ------------------ |
| **行为分类** | LSTM          | GRU, 1D CNN        |
| **异常检测** | Autoencoder   | VAE, One-Class SVM |
| **特征提取** | 统计特征 + LSTM特征 | -                  |

### 3.2 系统架构图

```
┌─────────────────────────────────────────────────────────┐
│                     前端展示层 (React)                    │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │ 数据上传界面  │  │ 仪表盘展示    │  │ 智能问答界面  │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
                            ↕
┌─────────────────────────────────────────────────────────┐
│                     后端服务层 (Robyn)                    │
│  ┌──────────────────────────────────────────────────┐  │
│  │           API路由层 (RESTful API)                  │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌─────────┐│
│  │数据处理服务 │ │ 分析服务   │ │ Agent服务  │ │告警服务  ││
│  └────────────┘ └────────────┘ └────────────┘ └─────────┘│
└─────────────────────────────────────────────────────────┘
                            ↕
┌─────────────────────────────────────────────────────────┐
│                     核心分析层                            │
│  ┌──────────────────────────────────────────────────┐  │
│  │         基础统计分析模块 (Pandas/NumPy)            │  │
│  │  - 总用电量、日均、峰谷统计                         │  │
│  │  - 负荷曲线生成、报告导出                           │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │      深度学习模型模块 (PyTorch)                    │  │
│  │  - 行为模式分类器 (LSTM)                          │  │
│  │  - 异常检测器 (Autoencoder)                       │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │         LLM Agent模块                             │  │
│  │  - 上下文构建                                      │  │
│  │  - 多后端LLM调用 (OpenAI/Anthropic/Ollama)        │  │
│  │  - 建议生成                                        │  │
│  └──────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────┐  │
│  │         告警与通知模块                              │  │
│  │  - 异常检测触发                                    │  │
│  │  - 邮件通知 (SMTP)                                │  │
│  └──────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
                            ↕
┌─────────────────────────────────────────────────────────┐
│                     数据存储层                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │ 用电数据存储  │  │ 模型权重存储  │  │ 分析结果缓存  │  │
│  │ (CSV/DB)     │  │ (.pth)       │  │ (Redis)      │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
                            ↑
┌─────────────────────────────────────────────────────────┐
│                     外部数据源                            │
│  ┌──────────────────────────────────────────────────┐  │
│  │         模拟用电数据生成器                          │  │
│  │  - 定时生成随机用电数据                             │  │
│  │  - 模拟不同用电行为模式                             │  │
│  │  - POST 数据至后端 API                             │  │
│  └──────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

---

### 阶段1：设计与规划（2025.12 - 2026.1）

#### 2025.12.26 前：开题报告

- [x] 文献综述
- [x] 英文翻译（≥8000英文字符）
- [x] 研究内容与技术路线确定

#### 2026.1.9 前：概要设计

- [ ] 系统整体架构设计
- [ ] 模块划分与接口定义
- [ ] 技术选型最终确认

#### 2026.1.23 前：详细设计

- [ ] 数据库/存储结构设计
- [ ] API 接口详细设计
- [ ] 深度学习模型架构设计
- [ ] 前端界面原型设计

---

### 阶段2：核心功能开发（2026.1 - 2026.2）

#### 2026.2.6 前：数据预处理模块

**任务清单**：

- [ ] **数据处理模块**
  - [ ] CSV/Excel数据读取
  - [ ] 数据清洗和预处理
  - [ ] 时间序列对齐

- [ ] **统计分析模块**
  - [ ] 基础统计指标计算
  - [ ] 峰谷平时段分析
  - [ ] 负荷特征提取

- [ ] **可视化模块**
  - [ ] 负荷曲线图生成
  - [ ] 峰谷比例饼图
  - [ ] 趋势分析图表

#### 2026.2.15 前：基础系统实现

**任务清单**：

- [ ] **简单分类模块**
  - [ ] 基于规则的行为模式判断
  - [ ] 或K-Means聚类实现

- [ ] **报告生成模块**
  - [ ] 规则模板建议生成
  - [ ] 报告格式化输出

- [ ] **界面开发**
  - [ ] Robyn 后端 API 搭建
  - [ ] React 前端仪表盘

**里程碑**：✅ 完成可演示的基础系统，满足导师所有要求

---

### 阶段3：深度学习模型开发（2026.2 - 2026.3）

#### 2026.3.9 前：模型开发与训练

**任务清单**：

- [ ] **数据准备**
  - [ ] 下载公开数据集（UK-DALE/REFIT）
  - [ ] 数据标注（行为模式标签）
  - [ ] 训练/验证/测试集划分
  - [ ] 数据增强策略实现

- [ ] **LSTM模型实现**
  - [ ] LSTM模型类定义（继承nn.Module）
  - [ ] 前向传播逻辑实现
  - [ ] 超参数配置（隐藏层大小、层数、Dropout率）
  - [ ] 损失函数和优化器选择

- [ ] **模型训练**
  - [ ] 本地/云GPU环境配置
  - [ ] 超参数调优
  - [ ] 模型训练和验证（目标：准确率 ≥ 85%）
  - [ ] 模型量化（FP16/INT8）

- [ ] **异常检测模型**
  - [ ] Autoencoder模型实现（编码器/解码器结构）
  - [ ] 无监督训练（正常数据训练、重构误差计算）
  - [ ] 异常阈值确定（基于验证集）
  - [ ] 异常检测逻辑（实时评分、滑动窗口）

- [ ] **模型集成**
  - [ ] 模型推理接口封装
  - [ ] 模型加载和缓存优化
  - [ ] 推理性能测试（目标：≤ 2秒）
  - [ ] 与统计分析模块联动

**里程碑**：✅ 深度学习模型成功集成，可进行实时推理

---

### 阶段4：LLM Agent 集成（2026.3）

#### 2026.3 中旬：Agent开发

**任务清单**：

- [ ] **LLM后端集成**
  - [ ] OpenAI API接入
  - [ ] Anthropic API接入
  - [ ] Ollama本地部署配置
  - [ ] 多后端切换机制

- [ ] **Agent逻辑**
  - [ ] 上下文构建模块
  - [ ] Prompt工程优化
  - [ ] 对话历史管理
  - [ ] 建议生成流程

- [ ] **界面集成**
  - [ ] 问答交互界面
  - [ ] 流式输出展示
  - [ ] 建议展示优化

**里程碑**：✅ 智能Agent上线，提供个性化建议

---

### 阶段5：优化与测试（2026.3 - 2026.4）

#### 2026.4.17 前：系统优化与论文初稿

**系统优化任务**：

- [ ] 性能优化（响应时间 ≤ 3秒）
- [ ] UI/UX优化
- [ ] 错误处理和异常捕获
- [ ] 单元测试和集成测试
- [ ] 部署脚本编写

**论文初稿任务**：

- [ ] 需求分析章节
- [ ] 系统设计章节
- [ ] 实现细节章节
- [ ] 测试报告章节


---

## 📊 五、项目最终介绍（用于答辩/申请）

### 5.1 项目简介

本项目开发了一个**基于深度学习的居民用电行为分析与节能建议智能体系统**。系统能够导入家庭用电数据，通过统计分析和深度学习模型（LSTM分类 + Autoencoder异常检测）自动识别用电行为模式、检测异常用电，并结合大语言模型生成个性化节能建议。

### 5.2 核心创新点

1. **稳定可靠的深度学习架构**：采用LSTM和Autoencoder等成熟时序模型，从零实现神经网络

2. **多层次分析体系**：结合传统统计分析与深度学习，既保证可解释性又提升准确性

3. **智能化交互**：集成LLM Agent，提供对话式节能建议，而非简单规则模板

4. **端到端系统**：完整的数据处理→模型训练→Web应用→智能问答全流程

5. **工程化实践**：模型训练、验证、部署全流程工程实现

### 5.3 技术亮点

| 亮点          | 说明                               |
| ----------- | -------------------------------- |
| **自训练模型**   | 从零实现LSTM和Autoencoder，非调库调用       |
| **时序建模**    | 使用LSTM捕捉用电行为的长期依赖关系              |
| **无监督异常检测** | 同时完成行为分类和异常检测                    |
| **LLM集成**   | 支持OpenAI/Anthropic/Ollama多种LLM后端 |
| **高性能推理**   | 模型量化后可在RTX 3050 Laptop流畅运行       |
| **现代技术栈**   | Robyn异步框架、uv包管理、PyTorch 2.0+     |

### 5.4 功能完整性

- 数据导入（CSV/Excel）
- 基础统计分析（总用电量、峰谷分析等）
- 负荷模式识别
- 可视化报告生成
- 节能建议输出
- 仪表盘展示
- 深度学习行为分类（vs 简单聚类）
- 异常检测与邮件告警
- LLM智能问答（vs 规则模板）
- 现代Web架构（Robyn + React 前后端分离）
- 模拟用电数据生成（用于测试演示）
- 报告导出功能（PDF/Excel）

